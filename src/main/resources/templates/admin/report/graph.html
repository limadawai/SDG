<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <head th:include="admin/layout :: header">
    <title th:text="SDG Report Graph"></title>
</head>
<body>
    <div th:include="admin/layout :: menu"></div>
    <div id="content">
        <div id="content-header">
            <div id="breadcrumb" class="lang_indo"> <a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>Laporan / Grafik</a></div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div id="selopt" style="width:100%">
                    <select id="daerah" name="daerah" class="form-control">
                        <option value="0" >-- Pilih Daerah --</option>
                        <option th:each="f:${listprov}" th:value="${f.id_prov}" th:text="${f.acronym}"></option>
                    </select>
                    <select id="selrole" name="role" class="form-control">
                        <option value="0" >-- Pilih Role --</option>
                    </select>
                    <select id="periode" name="periode" class="form-control">
                        <option value="0" >-- Pilih Periode --</option>
                    </select>
                </div>
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-tasks"></i></span>
                        <h5 id="title">Grafik Hasil Pelaporan</h5>
                    </div>
                    <div class="widget-content" style="background:#FFFFFF;">
                        <div class="row-fluid">
                            <div id="divkiri" class="span6"></div>
                            <div id="divkanan" class="span6">
                                <p><h4 id="patas" style="margin-left:10px;">Pemerintah</h4></p>
                                <div id="kananatas" class="span12" style="margin:0;padding:0;">
                                </div>
                                <p><h4 id="pbawah" style="margin-left:10px;">Non-Pemerintah</h4></p>
                                <div id="kananbawah" class="span12" style="margin:0;padding:0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:include="admin/layout :: footer"></div>
    <script th:inline="javascript">
        var lang = [[${lang}]];
        if (lang == null ) {lang = "0";};
        var name = [[${name}]];
        var idrole = [[${idrole}]];
        $("#welcome").html("Welcome, "+name);

        indo();

        if (lang == "0") {
            indo();
        } else {
            inggris();
        }

        $('#fs').on('change', function(){
            if($(this).is(':checked')){
                indo();
            } else {
                inggris();
            }
        });

        function indo() {
            $("#title").text("Grafik hasil Pelaporan");
            $("#patas").text("Pemerintah");
            $("#pbawah").text("Non-Pemerintah");
        }

        function inggris() {
            $("#title").text("Monitoring Graph");
            $("#patas").text("Government");
            $("#pbawah").text("Non-Government");
        }
        
        // ********************** Content Div Kiri **********************
        
        function getTarget(id) {
        	$.ajax({
        		url: urls + "getalltarget",
        		type: 'get',
        		data: 'id_goals='+id,
        		dataType: 'json',
        		cache: false,
        		success: function (restarget) {
        			//console.log(restarget);
        			var isitarget = "<ul id='ultar"+id+"'>";
        			for (var i=0; i<restarget.length; i++) {
        				isitarget += "<li>"+restarget[i][1]+"</li>";
        				getIndicator(id, restarget[i][0]);
        			}
        			isitarget += "</ul>";
        			$("#li"+id).append(isitarget);
        		}
      	   	});
        }
        
        function getIndicator(idgoals, idtarget) {
        	$.ajax({
        		url: urls + "getallindicator",
        		type: 'get',
        		data: {'id_goals':idgoals, 'id_target':idtarget},
        		dataType: 'json',
        		cache: false,
        		success: function (resindi) {
        			//console.log(resindi);
        			var isiindi = "<ul id='ulindi"+idgoals+"'>";
        			for (var i=0; i<resindi.length; i++) {
        				isiindi += "<li id='lisdg' style='cursor:pointer;color:#7F7FFF;' onclick='cucukanan("+idgoals+", "+idtarget+", "+resindi[i][0]+", "+$("#periode").val()+","+1+")'>"+resindi[i][1]+"</li>";
        				getDisaggre(idgoals, resindi[i][0]);
        			}
        			isiindi += "</ul>";
        			$("#ultar"+idgoals).append(isiindi);
        		}
        	});
        }
        
        function getDisaggre(idgoals, idindicator) {
        	$.ajax({
        		url: urls + "getalldisaggre",
        		type: 'get',
        		data: 'id_indicator='+idindicator,
        		dataType: 'json',
        		cache: false,
        		success: function (resdis) {
        			//console.log(resdis);
        			var isidis = "<ul style='list-style:none;margin-left:-4px;'>";
        			for (var i=0; i<resdis.length; i++) {
        				isidis += "<li><p>Jenis Agregasi : "+resdis[i][1]+"</p><p>"+resdis[i][3]+"</p><p>"+resdis[i][4]+"</p></li>";
        			}
        			isidis += "</ul>";
        			$("#ulindi"+idgoals).append(isidis);
        		}
        	});
        }
        
        // ********************** Content Div Kanan Atas **********************
        function getGovActivity(idprogram) {
        	$.ajax({
        		url: urls + "getallgovactivity",
        		type: 'get',
        		data: 'id_program='+idprogram,
        		dataType: 'json',
        		cache: false,
        		success: function (resactivity) {
        			//console.log(resactivity);
        			var isiactivity = "<ul id='ulact"+idprogram+"'>";
        			for (var i=0; i<resactivity.length; i++) {
        				isiactivity += "<li>"+resactivity[i][2]+"</li>";
        				getGovIndicator(idprogram, resactivity[i][0]);
        			}
        			isiactivity += "</ul>";
        			$("#olprog").append(isiactivity);
        		}
      	   	});
        }
        
        function getGovIndicator(idprogram, idactivity) {
        	$.ajax({
        		url: urls + "getallgovindi",
        		type: 'get',
        		data: {'id_program':idprogram, 'id_activity':idactivity},
        		dataType: 'json',
        		cache: false,
        		success: function (resgovindicator) {
        			//console.log(resgovindicator);
        			var isiindicator = "<ul id='ulindi"+idprogram+"'>";
        			for (var i=0; i<resgovindicator.length; i++) {
        				isiindicator += "<li style='cursor:pointer;color:#7F7FFF;' onclick='cucukanan("+idprogram+","+idactivity+","+resgovindicator[i][0]+","+$("#periode").val()+","+2+")'>"+resgovindicator[i][1]+"</li>";
        			}
        			isiindicator += "</ul>";
        			$("#ulact"+idprogram).append(isiindicator);
        		}
      	   	});
        }
        
     	// ********************** Content Div Kanan Bawah **********************
     	function getNsaActivity(idprogram) {
        	$.ajax({
        		url: urls + "getallnsaactivity",
        		type: 'get',
        		data: 'id_program='+idprogram,
        		dataType: 'json',
        		cache: false,
        		success: function (resactivity) {
        			//console.log(restarget);
        			var isiactivity = "<ul id='ulactnsa"+idprogram+"'>";
        			for (var i=0; i<resactivity.length; i++) {
        				isiactivity += "<li>"+resactivity[i][1]+"</li>";
        				getNsaIndicator(idprogram, resactivity[i][0]);
        			}
        			isiactivity += "</ul>";
        			$("#linsa"+idprogram).append(isiactivity);
        		}
      	   	});
        }
     	
     	function getNsaIndicator(idprogram, idactivity) {
        	$.ajax({
        		url: urls + "getallnsaindi",
        		type: 'get',
        		data: {'id_program':idprogram, 'id_activity':idactivity},
        		dataType: 'json',
        		cache: false,
        		success: function (resnsaindicator) {
        			//console.log(resnsaindicator);
        			var isiindicator = "<ul id='ulindinsa"+idprogram+"'>";
        			for (var i=0; i<resnsaindicator.length; i++) {
        				isiindicator += "<li style='cursor:pointer;color:#7F7FFF;' onclick='cucukanan("+idprogram+","+idactivity+","+resnsaindicator[i][0]+","+$("#periode").val()+","+3+")'>"+resnsaindicator[i][1]+"</li>";
        			}
        			isiindicator += "</ul>";
        			$("#ulactnsa"+idprogram).append(isiindicator);
        		}
      	   	});
        }

        // ********************** Fungsi pilih select option **********************
        
        $("#daerah").on("change", function(){
            var valdaerah = $(this).val();
            $.ajax({
            	url: urls + "getallrolebyprov",
                type: 'get',
                data: {'id_prov':valdaerah},
                dataType: 'json',
                cache: false,
                success: function (resrole) {
                	//console.log(resrole);
                	$("#selrole").empty();
                	$("#selrole").append("<option value='0'>-- Pilih Role --</option>");
                	for (var i=0; i<resrole.length; i++) {
                		var opt = "<option value='"+resrole[i][0]+"'>"+resrole[i][1]+"</option>";
                		$("#selrole").append(opt);
                	}
                }
            });
            $.ajax({
            	url: urls + "getmonper",
                type: 'get',
                data: {'id_prov':valdaerah},
                dataType: 'json',
                cache: false,
                success: function (resmonper) {
                	//console.log(resmonper);
                	$("#periode").empty();
                	$("#kananatas").empty();
                	$("#kananbawah").empty();
                	$("#periode").append("<option value='0'>-- Pilih Periode --</option>");
                	for (var i=0; i<resmonper.length; i++) {
                		var opt = "<option value='"+resmonper[i][0]+"'>"+resmonper[i][1]+" - "+resmonper[i][2]+"</option";
                		$("#periode").append(opt);
                	}
                }
            });
            
        	//=============== SDG Goals ================
            $.ajax({
            	url: urls + "getallgoals",
                type: 'get',
                dataType: 'json',
                cache: false,
                success: function (resgoals) {
                	//console.log(resgoals);
                	$("#divkiri").empty();
                	var isi = "<ol id='olgoals'>";
               		for (var i=0; i<resgoals.length; i++) {
                  	   	isi += "<li id='li"+resgoals[i][0]+"'>"+resgoals[i][1]+"</li>";
                  	   	getTarget(resgoals[i][0]);
                    }
                    isi += "</ol>";
                    $("#divkiri").append(isi);
                }
            });
        });
        
        $("#periode").on("change", function(){
        	var valdaerah = $("#daerah").val();
        	var valperiode = $(this).val();
            
          	//=============== Gov Program ================
          	$.ajax({
            	url: urls + "getallgovprogram",
                type: 'get',
                data: {'id_prov':valdaerah},
                dataType: 'json',
                cache: false,
                success: function (resprog) {
                	//console.log(resprog);
                	$("#kananatas").empty();
                	var isi = "<ol id='olprog'>";
               		for (var i=0; i<resprog.length; i++) {
                  	   	isi += "<li id='li"+resprog[i][1]+"'>"+resprog[i][2]+"</li>";
                  	   	getGovActivity(resprog[i][1]);
                    }
                    isi += "</ol>";
                    $("#kananatas").append(isi);
                }
            });
          	
          	//=============== Non Nsa Program ================
        	$.ajax({
            	url: urls + "getallnsaprogram",
                type: 'get',
                data: {'id_prov':valdaerah},
                dataType: 'json',
                cache: false,
                success: function (resprog) {
                	//console.log(resprog);
                	$("#kananbawah").empty();
                	var isi = "<ol id='olprog'>";
               		for (var i=0; i<resprog.length; i++) {
                  	   	isi += "<li id='linsa"+resprog[i][0]+"'>"+resprog[i][2]+"</li>";
                  	   	getNsaActivity(resprog[i][0])
                    }
                    isi += "</ol>";
                    $("#kananbawah").append(isi);
                }
            });
        });
        
        var valprov = $("#daerah option:selected").val();
        if (valprov == "000") {
        	//$("#lisdg").css({"cursor":"pointer","color":"#7F7FFF"});
        }

        function cucukanan(idsdg, idtar, idindi, idmon, flag) {
        	//alert(idsdg+" "+idtar+" "+idindi+" "+idmon+" "+flag);
        	var valda = $("#daerah option:selected").val();
        	var valrole = $("#selrole option:selected").val();
        	if (valrole == "0") {
        		swal("Anda harus memilih tipe Role");
        	} else {
        		location.href = urls+"report-graph-detail/"+idsdg+"/"+idtar+"/"+idindi+"/"+idmon+"/"+flag+"/"+valda+"/"+valrole;
                //window.open(urls+"report-graph-detail/"+idsdg+"/"+idtar+"/"+idindi+"/"+idmon+"/"+flag+"/"+valda, "_blank");
        	}
        }

    </script>
</body>
</html>