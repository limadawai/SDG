<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<head th:include="admin/layout :: header">
    <title th:text="SDG Indicator Monitoring">SDG Indicator Monitoring</title>
</head>
<body>
<div th:include="admin/layout :: menu"></div>
<div id="content">
    <div id="content-header">
        <div id="breadcrumb" class="lang_indo"> <a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>Laporan / Monitoring</a></div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div style="width:100%">
                <select id="daerah" name="daerah" class="form-control">
                    <option value="0" >-- Pilih Daerah --</option>
                    <option th:each="f:${listprov}" th:value="${f.id_prov}" th:text="${f.acronym}"></option>
                </select>
                <select id="role" name="idrole" class="form-control">
                    <option value="0" >-- Pilih Role --</option>
                </select>
                <select id="periode" name="idmonper" class="form-control">
                    <option value="0" >-- Pilih Periode --</option>
                </select>
            </div>
            <div style="width:100%">
                <select id="goals" name="goals" class="form-control">
                    <option value="0" >-- Pilih SDGs --</option>
                    <option id="optgoals" th:each="f:${listgoals}" th:value="${f.id}" th:text="${f.nm_goals}"></option>
                </select>
                <select id="target" name="target" class="form-control">
                    <option value="0" >-- Pilih Target --</option>
                </select>
                <select id="indikator" name="indikator" class="form-control">
                    <option value="0" >-- Pilih Indikator --</option>
                </select>
            </div>
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-tasks"></i></span>
                    <h5 id="title">Laporan Hasil Monitor</h5>
                </div>
                <div class="widget-content">
                    <div id="indi">
	                	<!-- <div id="divgoals" style="width:100%"></div>
	                	<div id="divtarget" style="width:100%"></div>
                    	<table id="tabatas" class='table table-striped table-bordered'></table><br><br> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:include="admin/layout :: footer"></div>
<script th:inline="javascript">
    var lang = [[${lang}]];
    if (lang == null) lang = "0";
    var name = [[${name}]];
    var role = [[${role}]];
    $("#welcome").html("Welcome, "+name);

    indo();

    if (lang == "0") {
        indo();
    } else {
        inggris();
    }

    $('#fs').on('change', function(){
        if($(this).is(':checked')){
            indo();
        } else {
            inggris();
        }
    });

    function indo() {
        $("#title").text("Laporan Hasil Monitor");
        $("#th1").text("Sumber Pendanaan");
        $("#th2").text("Satuan");
        $("#th3").text("Baseline");
    }

    function inggris() {
        $("#title").text("Monitoring Report");
        $("#th1").text("Funding Source");
        $("#th2").text("Unit");
        $("#th3").text("Baseline");
    }

    // ********************** Fungsi pilih select option Provinsi **********************
    $("#daerah").on("change", function(){
        var valdaerah = $(this).val();
        if (valdaerah != "0") {
            $.ajax({
                url: urls + "getrolebyidprov",
                type: 'get',
                data: 'id_prov='+valdaerah,
                dataType: 'json',
                cache: false,
                success: function(result) {
                    //console.log(result);
                    $("#role").empty();
                    $("#role").append("<option value='0'>-- Pilih Role --</option>");
                    for (var i=0; i<result.length; i++) {
                        $("#role").append("<option value='" + result[i]['id_role'] + "'>" + result[i]['nm_role'] + "</option>");
                    }
                }
            });
            $.ajax({
                url: urls + "getranradbyidprov",
                type: 'get',
                data: 'id_prov='+valdaerah,
                dataType: 'json',
                cache: false,
                success: function(result) {
                    $("#periode").empty();
                    $("#periode").append("<option value='0'>-- Pilih Periode --</option>");
                    for (var i = 0; i < result.length; i++) {
                        $("#periode").append("<option value='" + result[i]['id_monper'] + "'>" + result[i]['start_year'] + " - " + result[i]['end_year'] + "</option>");
                    }
                }
            });
        }
    });

    // ********************** Fungsi pilih select option Role **********************
    var status;
    function callback(response) {
        status = response;
    }
    $("#role").on("change", function(){
        var idrole = $(this).val();
        if (idrole != "0") {
            $.ajax({
                url: urls + "getdatarole",
                type: 'get',
                data: 'id_role=' + idrole,
                dataType: 'json',
                cache: false,
                global: false,
                success: function (result) {
                    // console.log(result[0]);
                    callback(result[0]);
                }
            });
        }
    });

    $("#periode").on("change", function(){
        var idmonper = $(this).val();
        var idrole = $("#role").val();
        var idprov = $("#daerah").val();
        $.ajax({
        	url: urls + "getentryshowreport",
            type: 'get',
            data: 'id_monper=' + idmonper,
            dataType: 'json',
            cache: false,
            success: function (res) {
            	console.log(res);
            	if (res.length == 0) {
            		swal("Data tidak ditemukan!");
            		if (lang == "1") {
            			swal("Data not found!");
            		}
            	} else {
            		var idrole = $("#role").val();
            		for (var i=0; i<res.length; i++) {
            			if (res[i][5] == "entry_sdg") {
	                		$.ajax({
	                			url: urls + "getentrysdg",
	                            type: 'get',
	                            data: {"id_role":idrole, "id_monper":res[i][1], "year_entry":res[i][2]},
	                            dataType: 'json',
	                            cache: false,
	                            global: false,
	                            success: function (result) {
	                            	//console.log(result[0][1]);
	                            	for (var i=0; i<result.length; i++) {
	                            		var div = "<div style='width:100%;padding:4px;text-align:center;background-color:#3EC1E9;display:block;'>"
	                            					+"<b><p id='goals"+(i+1)+"' style='margin-top:7px;'>-</p></b>"
	                            					+"</div><br>";
	                            		div += "<p id='target"+(i+1)+"'>-</p>";
	                            		div += "<p id='indikator"+(i+1)+"'>-</p>";
	                            		div += "<table id='tabatas"+(i+1)+"' class='table table-striped table-bordered'></table>";
	                            		$("#indi").append(div);
	                            		//***************** Tabel Atas *****************
	                            		if (result[i][15] == "yearly") {
	                            			var tab = "<tr>";
	                            	    	tab += "<th id='head1' style='vertical-align:middle;width:10%;' rowspan='4'>Sumber Pendanaan</th>";
	                            	    	tab += "<th id='head2' style='vertical-align:middle;width:10%;' rowspan='4'>Satuan</th>";
	                            	    	tab += "<th id='head3' style='vertical-align:middle;width:10%;' rowspan='4'>Baseline</th>";
	                            	    	tab += "<th id='head3' style='vertical-align:middle;width:10%;' colspan='5'>Target</th>";
	                            	    	tab += "<th id='head3' style='vertical-align:middle;width:10%;' colspan='5'>Realisasi</th>";
	                            	    	tab += "<th id='head3' style='vertical-align:middle;width:10%;' rowspan='4'>Status</th>";
	                            	    	tab += "</tr>";
	                            	    	tab += "<tr>";
	                            	    	tab += "<th id='htar1' style='vertical-align:middle;width:10%;' rowspan='3'>1920</th>";
	                            	    	tab += "<th id='htar2' style='vertical-align:middle;width:10%;' rowspan='3'>1921</th>";
	                            	    	tab += "<th id='htar3' style='vertical-align:middle;width:10%;' rowspan='3'>1922</th>";
	                            	    	tab += "<th id='htar4' style='vertical-align:middle;width:10%;' rowspan='3'>1923</th>";
	                            	    	tab += "<th id='htar5' style='vertical-align:middle;width:10%;' rowspan='3'>1924</th>";
	                            	    	tab += "</tr>";
	                            	    	tab += "<tr>";
	                            	    	tab += "<th id='hreal1' style='vertical-align:middle;width:10%;' colspan='1'>1920</th>";
	                            	    	tab += "<th id='hreal2' style='vertical-align:middle;width:10%;' colspan='1'>1921</th>";
	                            	    	tab += "<th id='hreal3' style='vertical-align:middle;width:10%;' colspan='1'>1922</th>";
	                            	    	tab += "<th id='hreal4' style='vertical-align:middle;width:10%;' colspan='1'>1923</th>";
	                            	    	tab += "<th id='hreal5' style='vertical-align:middle;width:10%;' colspan='1'>1924</th>";
	                            	    	tab += "</tr>";
	                            	    	tab += "<tr>";
	                            	    	tab += "<th style='vertical-align:middle;width:10%;'>I</th>";
	                            	    	tab += "<th style='vertical-align:middle;width:10%;'>I</th>";
	                            	    	tab += "<th style='vertical-align:middle;width:10%;'>I</th>";
	                            	    	tab += "<th style='vertical-align:middle;width:10%;'>I</th>";
	                            	    	tab += "<th style='vertical-align:middle;width:10%;'>I</th>";
	                            	    	tab += "</tr>";
	                            	    	$("#tabatas"+(i+1)).append(tab);
	                            	    	var rowatas = "<tr id='rowat"+(i+1)+"'>";
	                            	    	rowatas += "<td id='rowatas1'></td>";
	                            	    	rowatas += "<td id='rowatas2' style='text-align:center;'></td>";
	                            	    	rowatas += "<td id='rowatas3'></td>";
	                            	    	rowatas += "<td id='rowatas4' style='text-align:center;'>0</td>";
	                            	    	rowatas += "<td id='rowatas5' style='text-align:center;'>0</td>";
	                            	    	rowatas += "<td id='rowatas6' style='text-align:center;'>0</td>";
	                            	    	rowatas += "<td id='rowatas7' style='text-align:center;'>0</td>";
	                            	    	rowatas += "<td id='rowatas8' style='text-align:center;'>0</td>";
	                            	    	rowatas += "<td id='rowatas9'></td>";
	                            	    	rowatas += "<td id='rowatas10'></td>";
	                            	    	rowatas += "<td id='rowatas11'></td>";
	                            	    	rowatas += "<td id='rowatas12'></td>";
	                            	    	rowatas += "<td id='rowatas13'></td>";
	                            	    	rowatas += "<td id='rowatas14'></td>";
	                            	    	rowatas += "</tr>";
	                            	    	$("#tabatas"+(i+1)).append(rowatas);
			                        		$.ajax({
			                        			url: urls + "getstartyear",
			    	                            type: 'get',
			    	                            data: {"id_monper":res[i][1]},
			    	                            dataType: 'json',
			    	                            cache: false,
			    	                            global: false,
			    	                            success: function (resmonper) {
			    	                            	//console.log(resmonper);
			    	                            	var thn = parseInt(resmonper[0]);
			    	                            	$("#htar1").text(thn+0);
			    	                            	$("#htar2").text(thn+1);
			    	                            	$("#htar3").text(thn+2);
			    	                            	$("#htar4").text(thn+3);
			    	                            	$("#htar5").text(thn+4);
			    	                            	$("#hreal1").text(thn+0);
			    	                            	$("#hreal2").text(thn+1);
			    	                            	$("#hreal3").text(thn+2);
			    	                            	$("#hreal4").text(thn+3);
			    	                            	$("#hreal5").text(thn+4);
			    	                            }
			                        		});
	                            		}
	                            		$.ajax({
	                            			url: urls + "getsdgbyindi",
	        	                            type: 'get',
	        	                            data: {"id_indicator":result[i][1]},
	        	                            dataType: 'json',
	        	                            cache: false,
	        	                            global: false,
	        	                            success: function (resindi) {
	        	                            	//console.log(resindi);
	        	                            	$("#goals"+(i+1)).text(resindi[0][7]);
        	                            		$("#target"+(i+1)).text(resindi[0][10]);
        	                            		$("#indikator"+(i+1)).text(resindi[0][3]);
        	                            		$("#rowat"+(i+1)+" > td#rowatas2").text(resindi[0][12]);
	        	                            }
	                            		});
	                            		$("#rowat"+(i+1)+" > td#rowatas4").text(result[i][2]);
	                            		$("#rowat"+(i+1)+" > td#rowatas5").text();
	                            		$("#rowat"+(i+1)+" > td#rowatas6").text();
	                            		$("#rowat"+(i+1)+" > td#rowatas7").text();
	                            		$("#rowat"+(i+1)+" > td#rowatas8").text();
	                            	}
	                            }
	                		});
            			} else if (result[i][5] == "entry_gov_indicator") {
            				
            			} else if (result[i][5] == "entry_nsa_indicator") {
            				
            			}
            		}
            	}
            }
        });
    });
    
</script>
</body>
</html>