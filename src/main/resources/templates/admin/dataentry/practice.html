<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<head th:include="admin/layout :: header">
    <title th:text="SDG Indicator Monitoring">SDG Indicator Monitoring</title>
</head>
<body>
    <div th:include="admin/layout :: menu"></div>

    <div id="content">
        <div id="content-header">
            <div id="breadcrumb"> 
            	<a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>
	            	<span class="lang_eng" style="display:none">Input Data / Best Practice</span>
					<span class="lang_indo">Input Data / Praktik Terbaik</span>
            	</a>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="widget-box">
                    <div class="widget-title" id="judul-indo">
                        <span class="icon"><i class="icon-tasks"></i></span>
                        <h5 id="jdltbl">
                        	<span class="lang_eng" style="display:none">List Best Practice</span>
							<span class="lang_indo">Daftar Praktik Terbaik</span>
                        </h5>
                    </div>
                    <div class="widget-content">
                    	<div class="row-fluid">
                            <div class="span8">
                                <select id="id_prov" name="id_prov" class="form-control">
                                    <option value="0" >-- Pilih --</option>
                                    <option th:each="f:${listprov}" th:value="${f.id_prov}" th:text="${f.acronym}"></option>
                                </select>
                                <select id="idrole" name="idrole" class="form-control">
                                    <option value="0" >-- Pilih --</option>
                                </select>
                                <select id="periode" name="periode" class="form-control">
                                    <option value="0" >-- Pilih --</option>
                                </select>
                            </div>
                            <div class="span4 app" align="right">
                                <button id="showModal" class="btn btn-primary">
                                    <i class="icon-plus"></i> 
                                    <span class="lang_eng" style="display:none">Add Best Practice</span>
                                    <span class="lang_indo">Tambah Praktik Terbaik</span>
                                </button>
                                <a class="btn btn-success appl" id="apply_btn" data-periode="1" style=" margin-left: 10px; display: none">
                                    <span class="lang_indo">Terapkan</span>
                                    <span class="lang_eng">Apply</span>
                                </a>
                                <a class="btn btn-warning unappl" id="unapply_btn" data-periode="1" style="display: none">
                                    <span class="lang_indo">Batal Terapkan</span>
                                    <span class="lang_eng">UnApply</span>
                                </a>
                            </div>
                    	</div>
                        <div class="row-fluid">
                            <div class="span12">
                                <table  id="tabel-practice" class="table table-striped table-bordered">
                                    <thead>
	                                    <tr>
	                                        <th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Name of Destination in TPB/SDGs</span>
                   								<span class="lang_indo">Nama Tujuan TPB/SDGs</span>
	                                        </th>
	                                        <th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Program Name</span>
                   								<span class="lang_indo">Nama Program</span>
	                                        </th>
	                                        <th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Location and Time of Activity</span>
                   								<span class="lang_indo">Lokasi dan Waktu Aktifitas</span>
	                                        </th>
	                                        <th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Background</span>
                   								<span class="lang_indo">Latar Belakang</span>
											</th>
	                                        <th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Implementation Process<br/>(Strategy, Parties involved, beneficiaries etc)</span>
                   								<span class="lang_indo">Proses Implementasi</span>
											</th>
											<th style="text-align:center;font-size:80%;" width="15%">
	                                        	<span class="lang_eng" style="display:none">Challenges and Learning</span>
                   								<span class="lang_indo">Tantangan dan Pembelajaran</span>
											</th>
											<th style="text-align:center;font-size:80%;" width="10%">
	                                        	<span class="lang_eng" style="display:none">Action</span>
                   								<span class="lang_indo">Aksi</span>
											</th>
	                                    </tr>
                                    </thead>
                                    <tbody id="tbody-best"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="myModal"data-backdrop="static" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 class="lang_eng" style="display:none">Add Best Pactice</h3>
                <h3 class="lang_indo">Tambah Praktik Terbaik</h3>
            </div>
            <div class="modal-body">
                <form id="form-sdgGoals">
<!--                    <div class="control-group">
                        <div class="controls">
                            <div class="accordion" id="accordion2">
                                <div class="accordion-group">
                                    <div class="accordion-heading">
                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                                            <label class="lang_eng control-label" style="display:none">Goals SDGs</label>
                                            <label class="lang_indo control-label">Sasaran SDG</label>
                                        </a>
                                    </div>
                                    <div id="collapseOne" class="accordion-body collapse">
                                          <div class="accordion-inner">
                                          </div>
                                    </div>
                                </div>
                            </div>
					    	 <select name="sdg_indicator" id="sdg_indicator" class=" input-block-level"  multiple="multiple" style="width:100%">
					    		<option value="0">--select--</option>
		        				<option th:each="f:${sdgIndicator}" th:value="${f.id_goals}+'---'+${f.id_target}+'---'+${f.id_indicator}" th:text="${f.nm_indicator}"></option>
		        			</select> 
                            <span class="help-block" id="error_unit"></span>
                        </div>
                    </div>-->
                    <div class="control-group">
                        <div class="controls">
                            <div class="accordion" id="accordion2">
                                <div class="accordion-group">
                                    <div class="accordion-heading">
                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                                            <label class="lang_eng control-label" style="display:none">Select SDGs Indicator</label>
                                            <label class="lang_indo control-label">Pilih Indikator SDG</label>
                                        </a>
                                    </div>
                                    <div id="collapseOne" class="accordion-body collapse">
                                        <div class="accordion-inner">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- <select name="sdg_indicator" id="sdg_indicator" class=" input-block-level"  multiple="multiple" style="width:100%">
                                    <option value="0">--select--</option>
                                    <option th:each="f:${sdgIndicator}" th:value="${f.id_goals}+'---'+${f.id_target}+'---'+${f.id_indicator}" th:text="${f.nm_indicator}"></option>
                            </select> -->
                            <span class="help-block" id="error_unit"></span>
                        </div>
                    </div>
<!--				<div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Program</label>
				    <label class="lang_indo control-label">Program</label>
				    <div class="controls">
				    	<select id="id_program" name="id_program" class="input-xlarge input-block-level">
				    	</select>
				    	
				    	<span class="help-block" id="error_id_program"></span>
				    </div>
				  </div>-->
                    <div class="control-group">
                        <label class="lang_eng control-label" style="display:none">Program</label>
                        <label class="lang_indo control-label">Program</label>
                        <div class="controls">
                            <textarea id="id_program" name="id_program" class="input-xlarge input-block-level"></textarea>
                            <input id="id" name="id" class="input-medium input-block-level" type="hidden"/>
                            <span class="help-block" id="error_background"></span>
                        </div>
                    </div>
				  
                    <div class="control-group">
                        <label class="lang_eng control-label" style="display:none">Location</label>
                        <label class="lang_indo control-label">Lokasi</label>
                        <div class="controls">
                            <input id="location" name="location" class="input-xlarge input-block-level" type="text"/>
                            <span class="help-block" id="error_location"></span>
                        </div>
                    </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Date and Time</label>
				    <label class="lang_indo control-label">Tanggal dan Waktu</label>
				    <div class="controls">
				    	<div id="datetimepicker1" class="input-append date">
						    <input id="time_activity" class="input-small" name="time_activity" data-format="dd/MM/yyyy hh:mm:ss" type="text"></input>
						    <span class="add-on">
						      <i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar">
						      </i>
						    </span>
					  	</div>
					  	<select id="jam" class="input-small">
					  	</select>:
					  	<select id="menit" class="input-small">
					  	</select>
				    	<span class="help-block" id="error_time_activity"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Background</label>
				    <label class="lang_indo control-label">Latar Belakang</label>
				    <div class="controls">
				    	<textarea id="background" name="background" class="input-xlarge input-block-level"></textarea>
				    	<span class="help-block" id="error_background"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Implementation Process</label>
				    <label class="lang_indo control-label">Proses Implementasi</label>
				    <div class="controls">
				    	<textarea id="implementation_process" name="implementation_process" class="input-xlarge input-block-level"></textarea>
				    	<span class="help-block" id="error_implementation_process"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Challenges and Learning</label>
				    <label class="lang_indo control-label">Tantangan dan Pembelajaran</label>
				    <div class="controls">
				    	<textarea id="challenges_learning" name="challenges_learning" class="input-xlarge input-block-level"></textarea>
				    	<span class="help-block" id="error_challenges_learning"></span>
				    </div>
				  </div>
				</form>
			</div>
			<div class="modal-footer">
		    	<button class="btn tutup" data-dismiss="modal" aria-hidden="true">
		    		<span class="lang_eng" style="display:none">Close</span>
		    		<span class="lang_indo">Tutup</span>
		    	</button>
		    	<button class="btn btn-primary" id="submit">
		    		<span class="lang_eng" style="display:none">Submit</span>
		    		<span class="lang_indo">Simpan</span>
		    	</button>
		  	</div>
		</div>
    </div>

    <div th:include="admin/layout :: footer"></div>
</body>
<script th:inline="javascript">
 // <![CDATA[
        var lang = [[${lang}]];
        var name = [[${name}]];
        var privilege = [[${privilege}]];
        var role = [[${id_role}]];
        var prov = [[${id_prov}]];
        $("#welcome").html("Welcome, "+name);
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
//        btn_apply();
        //$("#time_activity").datepicker();
        $('#time_activity').datepicker({
            autoclose: true,
            format: "yyyy-mm-dd"
        });
        function pad (str, max) {
        	  str = str.toString();
        	  return str.length < max ? pad("0" + str, max) : str;
        	}
        $("#jam").html("");
        for(var i=0; i<=23; i++){
        	$("#jam").append("<option value='"+(pad(i,2))+"'>"+(pad(i,2))+"</option>")
        }
        $("#menit").html("");
        for(var i=0; i<=59; i++){
        	$("#menit").append("<option value='"+(pad(i,2))+"'>"+(pad(i,2))+"</option>")
        }
        //Bahasa
        var titleDel = "Anda Yakin";
        var messDel = "Menghapus Data?";
        var buttDel = 'Ya, Hapus data ini!';
        var titleApp = "Anda Yakin";
        var messApp = "Apply Data ini?";
        var buttApp = 'Ya, Apply data ini!';
        var titleOk	= "Hapus";
        var messOk = "Data berhasil dihapus";
        var messNOk = "Data tidak dapat dihapus";
        var required = "Harus diisi";
        var titleUnApp = "Anda Yakin";
        var messUnApp = "Batal Terapkan Data ini?";
        var buttUnApp = 'Ya, Batal Terapkan data ini!';
        var titleMod = "Maaf";
        var messMod = "Semua pilihan harus dipilih";
        function bhs(cek){
            if(cek){
                $(".lang_indo").show();
                $(".lang_eng").hide();
                titleDel = "Anda Yakin";
                messDel = "Menghapus Data?";
                buttDel = 'Ya, Hapus data ini!';
                titleOk	= "Hapus";
    	        messOk = "Data berhasil dihapus";
    	        messNOk = "Data tidak dapat dihapus";
    	        required = "Harus diisi";
    	        titleApp = "Anda Yakin";
    	        messApp = "Terapkan Data ini?";
    	        buttApp = 'Ya, Terapkan data ini!';
    	        titleUnApp = "Anda Yakin";
    	        messUnApp = "Batal Terapkan Data ini?";
    	        buttUnApp = 'Ya, Batal Terapkan data ini!';
    	        titleMod = "Maaf";
    	        messMod = "Semua pilihan harus dipilih";
            }else{	    	        
    	        $(".lang_indo").hide();
                $(".lang_eng").show();
                titleDel = "Are you sure";
                messDel = "Delete this data?";
                buttDel = 'Yes, Delete this data!';
                titleOk	= "Delete";
    	        messOk = "Delete successful";
    	        messNOk = "Can't delete data";
    	        required = "Required";
    	        titleApp = "Are you sure";
    	        messApp = "Apply this data?";
    	        buttApp = 'Ya, Apply this data!';
    	        titleUnApp = "Are you sure";
    	        messUnApp = "Unapply this data?";
    	        buttUnApp = 'Ya, Unapply this data!';
    	        titleMod = "Sorry";
    	        messMod = "All dropdownlists must be selected";
            }
        }
        if(lang){
        	bhs(lang=="0");
        }else{
        	bhs($('#fs').is(':checked'));
        }
        
        $('#fs').on('change', function(e){
        	bhs($(this).is(':checked'));
        	if($('#id_prov').val() && $('#periode').val() && $('#idrole').val()){
        		var id = $("#periode").val().split("###");
            	var id_monper = id[0];
            	var year = id[1];
            	var id_role = $('#idrole').val();
            	table.ajax.url(urls+'list-best/'+id_role+'/'+id_monper+'/'+year).load();
                btn_apply();
        	}
        });
        
        function provChange(){
        	var id_prov = $("#id_prov").val() ;
            $.ajax({
                type: "GET",
                url: urls+'list-get-option-role-all-profil/'+id_prov,
                success: function (result) {
                    $("#idrole").html('<option value="0" >-- Pilih --</option>');
                    var array = result.content;
                    if (array != '') {
                    	/* if(privilege == 'ADMIN' || privilege == 'SUPER'){
                    		$("#idrole").append('<option value="all" >-- ALL --</option>');
                    	} */
                        for (i in array) {
                        	var selected =""
                        	if(privilege == 'USER' && role == array[i][0]){
                        		selected = "selected";
                           	}
                            $("#idrole").append('<option data-cat="'+array[i][3]+'" value="'+array[i][0]+'" '+selected+' >'+array[i][1]+'</option>');
                        }
                    	
                        if(privilege == 'USER'){
                        	$("#idrole").attr('disabled',true);
                       	}
                      	
                    }
                   // grid();
                }
            });
            
            $.ajax({
                type: "GET",
                url: urls+'list-get-option-monper/'+id_prov,
                success: function (result1) {
                    $("#periode").html('<option value="0" >-- Pilih --</option>');
                    var array1 = result1.content;
                    if (array1 != '') {
                        for (i in array1) {
                            var selisih     = (array1[i][2] - array1[i][1]);
                            var x;
                            for(x=0; x<=selisih; x++){
                                $("#periode").append('<option value="'+array1[i][0]+'###'+(array1[i][1]+x)+'" >'+(array1[i][1]+x)+'</option>');
                            }
                            
                        }
                    }
                }
            });
            table.ajax.url(urls+'list-best/0/0/0').load();
            btn_apply();
        }

        if(privilege == 'USER'){
       		$("#id_prov").val(prov).attr('disabled', true);
       		provChange();
       	}
        
        $("#id_prov").on('change',function(e){
        	provChange();
        });
        
        $("#idrole").on("change", function(){
            $("#periode").val(0).trigger("change");
            btn_apply();
        });
        
        $('.app').on('click', '.appl', function(e){
        	if($('#id_prov').val()!="0" && $('#periode').val()!="0" && $('#idrole').val()!="0"){
        		swal({
                    title: titleDel,
                    text: "",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: buttApp
                }).then(function () {
                    var periode             = "1";
                    var id_role             = $('#idrole').val();
                    var v_dataid            = $("#periode").val();
                    var v_data_id           = v_dataid.split("###");;
                    var id_monper           = v_data_id[0];
                    var year                = v_data_id[1];
//                    var id_monper           = monper_1;
//                    var year                = tahun_1;
                    var approval            = "1";
                    var type                = "entry_best_practice";

                    var data    = JSON.stringify({
                                    'id': null,
                                    'id_form_type': "0",
                                    'id_role': id_role,
                                    'id_monper': id_monper,
                                    'year': year,
                                    'approval': approval,
                                    'approval_date': null,
                                    'type': type,
                                    'periode': periode,
                                    'description': ''
                                });
                    console.log(data);
                    $.ajax({
                        type: "POST",
                        url: urls+'save-approve-gov_prog',
                        beforeSend : function(xhr){
                            xhr.setRequestHeader(header,token);
                        },
                        headers:{'Accept':'application/json','Content-Type':'application/json'},
                        data: data,
                        success: function (result) {
                            table.ajax.url(urls+'list-best/'+id_role+'/'+id_monper+'/'+year).load();
                            btn_apply();
                        },
                    });
                }, function (dismiss) {
                    if (dismiss === 'cancel') {
                    }
                });
        	}else{
        		swal(titleMod,messMod,'error');
        	}
            
        });
        
        $('.app').on('click', '.unappl', function(e){
        	if($('#id_prov').val()!="0" && $('#periode').val()!="0" && $('#idrole').val()!="0"){
        		swal({
                    title: titleDel,
                    text: "",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: buttApp
                }).then(function () {
                    var periode             = "1";
                    var id_role             = $('#idrole').val();
                    var v_dataid            = $("#periode").val();
                    var v_data_id           = v_dataid.split("###");;
                    var id_monper           = v_data_id[0];
                    var year                = v_data_id[1];
//                    var id_monper           = monper_1;
//                    var year                = tahun_1;
                    var approval            = "1";
                    var type                = "entry_best_practice";

                    var data    = JSON.stringify({
                                    'id': null,
                                    'id_form_type': "0",
                                    'id_role': id_role,
                                    'id_monper': id_monper,
                                    'year': year,
                                    'approval': approval,
                                    'approval_date': null,
                                    'type': type,
                                    'periode': periode,
                                    'description': ''
                                });
                    console.log(data);
                    $.ajax({
                        type: "POST",
                        url: urls+'delete-approve-gov_prog',
                        beforeSend : function(xhr){
                            xhr.setRequestHeader(header,token);
                        },
                        headers:{'Accept':'application/json','Content-Type':'application/json'},
                        data: data,
                        success: function (result) {
                            table.ajax.url(urls+'list-best/'+id_role+'/'+id_monper+'/'+year).load();
                            btn_apply();

                        },
                    });
                }, function (dismiss) {
                    if (dismiss === 'cancel') {
                    }
                });
        	}else{
        		swal(titleMod,messMod,'error');
        	}
        });
        
        function btn_apply(){
            var id_role             = $('#idrole').val();
            var v_dataid            = $("#periode").val();
            var v_data_id           = v_dataid.split("###");;
            var id_monper           = v_data_id[0];
            var year                = v_data_id[1];
//            var id_monper           = monper_1;
//            var year                = tahun_1;
            var type                = "entry_best_practice";
            $.ajax({
                type: "GET",
                url: urls+'get-status-approve/'+id_role+'/'+id_monper+'/'+year+'/'+type+'/1',
                success: function (result1) {
                    if(result1.content == "1"){
                        $('.appl').hide();
                        $('.unappl').show();
                        
                    }else if(result1.content == "2"){
                        $('.appl').hide();
                        $('.unappl').hide();
                        
                    }else if(result1.content == "3"){
                        $('.appl').show();
                        $('.unappl').hide();
                        
                    }else if(result1.content == "4"){
                        $('.appl').hide();
                        $('.unappl').hide();
                        
                    }else{
                        $('.appl').show();
                        $('.unappl').hide();
                        
                    }
                }
            });
        }
        
        function program(){
        	var id_prov = $('#id_prov').val();
        	var id_monper = $("#periode").val().split('###')[0];
        	var id_role = $('#idrole').val();
        	$.ajax({
                url: urls + 'list-govProg-entry/'+id_monper+'/'+id_role,
                type: 'get',
                dataType: 'json',
                cache: false,
                async : false,
                success: function (response) {
                		var option = "<option value='0'>-- Pilih --</option>";
                		$('#id_program').html("");
                		for (var i = 0; i < response.content.length; i++) {
                			var nm_goals;
                			var id_goals=response.content[i].id;
                        	if($("#fs").is(':checked')){
                        		nm_goals = response.content[i].nm_program;
    						}else{
    							nm_goals = response.content[i].nm_program_eng;
    						}
                        	option += '<optgroup id="" label="'+response.content[i].id_program+' '+nm_goals+'">';
                        	$.ajax({
                                url: urls + 'list-govActivity/'+response.content[i].id+'/'+id_role,
                                type: 'get',
                                dataType: 'json',
                                cache: false,
                                async : false,
                                success: function (result) {
                                	for (var j = 0; j < result.content.length; j++) {
                                		var nm_target;
                                		var id_target=result.content[j].id;
                                    	if($("#fs").is(':checked')){
                                    		nm_target = result.content[j].nm_activity;
                						}else{
                							nm_target = result.content[j].nm_activity_eng;
                						}
                                    	option += '<optgroup id="" label="'+result.content[j].id_activity+' '+nm_target+'">';
                                    	$.ajax({
                                            url: urls + 'list-govIndicator/'+response.content[i].id+'/'+result.content[j].id,
                                            type: 'get',
                                            dataType: 'json',
                                            cache: false,
                                            async : false,
                                            success: function (result1) {
                                            	for (var k = 0; k < result1.content.length; k++) {
                                            		var nm_indicator;
                                            		var id_indicator=result1.content[k][0];
                                                	if($("#fs").is(':checked')){
                                                		nm_indicator = result1.content[k][2];
                            						}else{
                            							nm_indicator = result1.content[k][5];
                            						}
                                                	option += '<option value="'+id_goals+'###'+id_target+'###'+result1.content[k][0]+'">'+result1.content[k][1]+' '+nm_indicator+'</option>';
                                            	}
                                            }
                                    	});
                                    	option += '</optgroup>';
                                	}
                                }
                        	});
                        	option += '</optgroup>';
                		}
                		$('#id_program').append(option);
                	}
                });
        }
        
        function programNsa(){
        	var id_prov = $('#id_prov').val();
        	var id_monper = $("#periode").val().split('###')[0];
        	var id_role = $('#idrole').val();
        	$.ajax({
                url: urls + 'list-nsaProg/'+id_role+'/'+id_monper,
                type: 'get',
                dataType: 'json',
                cache: false,
                async : false,
                success: function (response) {
                		var option = "<option value='0'>-- Pilih --</option>";
                		$('#id_program').html("");
                		for (var i = 0; i < response.content.length; i++) {
                			var nm_goals;
                			var id_goals=response.content[i].id;
                        	if($("#fs").is(':checked')){
                        		nm_goals = response.content[i].nm_program;
    						}else{
    							nm_goals = response.content[i].nm_program_eng;
    						}
                        	option += '<optgroup id="" label="'+response.content[i].id_program+' '+nm_goals+'">';
                        	$.ajax({
                                url: urls + 'list-nsaActivity/'+response.content[i].id,
                                type: 'get',
                                dataType: 'json',
                                cache: false,
                                async : false,
                                success: function (result) {
                                	for (var j = 0; j < result.content.length; j++) {
                                		var nm_target;
                                		var id_target=result.content[j].id;
                                    	if($("#fs").is(':checked')){
                                    		nm_target = result.content[j].nm_activity;
                						}else{
                							nm_target = result.content[j].nm_activity_eng;
                						}
                                    	option += '<optgroup id="" label="'+result.content[j].id_activity+' '+nm_target+'">';
                                    	$.ajax({
                                            url: urls + 'list-nsaIndicator/'+response.content[i].id+'/'+result.content[j].id,
                                            type: 'get',
                                            dataType: 'json',
                                            cache: false,
                                            async : false,
                                            success: function (result1) {
                                            	for (var k = 0; k < result1.content.length; k++) {
                                            		var nm_indicator;
                                            		var id_indicator=result1.content[k][0];
                                                	if($("#fs").is(':checked')){
                                                		nm_indicator = result1.content[k][2];
                            						}else{
                            							nm_indicator = result1.content[k][5];
                            						}
                                                	option += '<option value="'+id_goals+'###'+id_target+'###'+result1.content[k][0]+'">'+result1.content[k][1]+' '+nm_indicator+'</option>';
                                            	}
                                            }
                                    	});
                                    	option += '</optgroup>';
                                	}
                                }
                        	});
                        	option += '</optgroup>';
                		}
                		$('#id_program').append(option);
                	}
                });
        }
        
        $('#showModal').on('click', function(){
        	if($('#id_prov').val()!="0" && $('#periode').val()!="0" && $('#idrole').val()!="0"){
        		var cat = $("#idrole").find(":selected").data("cat");
        		if(cat=="NSA"){
        			programNsa();
        		}else{
        			program();
        		}
        		$("#myModal").modal("show");
        	}else{
        		swal(titleMod,messMod,'error');
        	}
        });
        
        var table = $('#tabel-practice').DataTable({
			responsive: true,
			sDom: 'lrtip',
			"bLengthChange": false,
			"cache": false,
			"autoWidth": true,
			"responsive":true,
			"ajax": {
				"url": urls+'list-best/0/0/0',
				dataSrc: 'content',
			},
			"searching": true,
			"columns": [
				{"data": function (row, data, index, display) {
					var cat = $("#idrole").find(":selected").data("cat");
					if(cat == "NSA"){
						var text = "";
						$.ajax({
			                url: urls + 'best-practice/list-nsamap/'+$('#id_prov').val()+'/'+$("#periode").val().split('###')[0]+'/'+row[8],
			                type: 'get',
			                dataType: 'json',
			                cache: false,
			                async : false,
			                success: function (result1) {
			                	for (var k = 0; k < result1.content.length; k++) {
			                		var nm_goals;
			                		var nm_target;
			                		var nm_indicator;
			                    	if($("#fs").is(':checked')){
			                    		nm_goals = result1.content[k][1];
			                    		nm_target = (result1.content[k][3]?result1.content[k][3]:"");
			                    		nm_indicator = (result1.content[k][5]?result1.content[k][5]:"");
									}else{
										nm_goals = result1.content[k][2];
										nm_target = (result1.content[k][4]?result1.content[k][4]:"");
										nm_indicator = (result1.content[k][6]?result1.content[k][6]:"");
									}
			                    	text += '<label style="display:inline-block;white-space:nowrap;">'+
						        				'<span style="vertical-align:middle">'+(result1.content[k][7]?result1.content[k][7]:"")+" "+nm_goals+'</span>'+
						                  '</label><br/>';
				                    text += '<label style="display:inline-block;white-space:nowrap;margin-left:20px">'+
						        					'<span style="vertical-align:middle">'+(result1.content[k][8]?result1.content[k][8]:"")+" "+nm_target+'</span>'+
						                     '</label><br/>';
				                     text += '<label style="display:inline-block;white-space:nowrap;margin-left:40px">'+
						                         '<span style="vertical-align:middle">'+(result1.content[k][9]?result1.content[k][9]:"")+" "+nm_indicator+'</span>'+
						                   '</label><br/>';
			                	}
			                }
			        	});
					}else{
                                            var text = row[11];
//						$.ajax({
//			                url: urls + 'best-practice/list-govmap/'+$('#id_prov').val()+'/'+$("#periode").val().split('###')[0]+'/'+row[8],
//			                type: 'get',
//			                dataType: 'json',
//			                cache: false,
//			                async : false,
//			                success: function (result1) {
//			                	for (var k = 0; k < result1.content.length; k++) {
//			                		var nm_goals;
//			                		var nm_target;
//			                		var nm_indicator;
//			                    	if($("#fs").is(':checked')){
//			                    		nm_goals = result1.content[k][1];
//			                    		nm_target = (result1.content[k][3]?result1.content[k][3]:"");
//			                    		nm_indicator = (result1.content[k][5]?result1.content[k][5]:"");
//									}else{
//										nm_goals = result1.content[k][2];
//										nm_target = (result1.content[k][4]?result1.content[k][4]:"");
//										nm_indicator = (result1.content[k][6]?result1.content[k][6]:"");
//									}
//			                    	text += '<label style="display:inline-block;white-space:nowrap;">'+
//						        				'<span style="vertical-align:middle">'+(result1.content[k][7]?result1.content[k][7]:"")+" "+nm_goals+'</span>'+
//						                  '</label><br/>';
//				                    text += '<label style="display:inline-block;white-space:nowrap;margin-left:20px">'+
//						        					'<span style="vertical-align:middle">'+(result1.content[k][8]?result1.content[k][8]:"")+" "+nm_target+'</span>'+
//						                     '</label><br/>';
//				                     text += '<label style="display:inline-block;white-space:nowrap;margin-left:40px">'+
//						                         '<span style="vertical-align:middle">'+(result1.content[k][9]?result1.content[k][9]:"")+" "+nm_indicator+'</span>'+
//						                   '</label><br/>';
//			                	}
//			                }
//			        	});
					}
					return "<div style='font-size:90%;'>"+text+"</div>";
				}},
				{"data": function (row, data, index, display) {
//						var nama="";
//						var cat = $("#idrole").find(":selected").data("cat");
//						if($("#fs").is(':checked')){
//							if(cat=="NSA"){
//								nama = row[9];
//							}else{
//								nama = row[1];	
//							}
//						}else{
//							if(cat=="NSA"){
//								nama = row[10];
//							}else{
//								nama = row[2];
//							}
//						}
//						return "<div style='font-size:90%;'>"+nama+"</div>";
						return "<div style='font-size:90%;'>"+row[11]+"</div>";
                                }},
				{"data": function (row, data, index, display) {
						return "<div style='font-size:90%;'>"+row[3]+" "+row[4]+"</div>";
					}},
				{"data": function (row, data, index, display) {
					return "<div style='font-size:90%;'>"+row[5]+"</div>";
				}},
				{"data": function (row, data, index, display) {
					return "<div style='font-size:90%;'>"+row[6]+"</div>";
				}},
				{"data": function (row, data, index, display) {
					return "<div style='font-size:90%;'>"+row[7]+"</div>";
				}},
				{"data": function (row, data, index, display) {
                                    var id_role             = $('#idrole').val();
                                    var v_dataid            = $("#periode").val();
                                    var v_data_id           = v_dataid.split("###");;
                                    var id_monper           = v_data_id[0];
                                    var year                = v_data_id[1];
                        //            var id_monper           = monper_1;
                        //            var year                = tahun_1;
                                    var type                = "entry_best_practice";
                                    var text1 = "";
                                    $.ajax({
                                        url: urls+'get-status-approve/'+id_role+'/'+id_monper+'/'+year+'/'+type+'/1',
                                        type: 'get',
			                dataType: 'json',
			                cache: false,
			                async : false,
                                        success: function (result1) {
//                                            alert('isi '+result1.content);
                                            if(result1.content == "1"){
                                                text1 += '';

                                            }else if(result1.content == "2"){
                                                $('.appl').hide();
                                                $('.unappl').hide();

                                            }else if(result1.content == "3"){
                                                var detail = "";
						var cat = $("#idrole").find(":selected").data("cat");
						if(cat=="NSA"){
                                                    detail = '<a data-id="'+row[0]+'" href="'+urls+'best-practice/detail/'+row[0]+'" title="detail" class="btn btn-success btn-mini">Detail</a></div>';
						}
						text1 += "<div style='text-align:center;'>"+
						'<button data-id="'+row[0]+'" type="button" title="edit" class="btn btn-warning btn-mini update">Edit</button>'+detail+"</div>";

                                            }else if(result1.content == "4"){
                                                text1 += '';

                                            }else{
                                                var detail = "";
						var cat = $("#idrole").find(":selected").data("cat");
						if(cat=="NSA"){
                                                    detail = '<a data-id="'+row[0]+'" href="'+urls+'best-practice/detail/'+row[0]+'" title="detail" class="btn btn-success btn-mini">Detail</a></div>';
						}
						text1 += "<div style='text-align:center;'>"+
						'<button data-id="'+row[0]+'" type="button" title="edit" class="btn btn-warning btn-mini update">Edit</button>'+detail+"</div>";

                                            }
                                        }
                                    });
                                    return text1;
                                }}
			],
			"columnDefs": [
			],
			select: true
		});	
        
        $('#periode').on('change', function(){
        	var id = $(this).val().split("###");
        	var id_monper = id[0];
        	var year = id[1];
        	var id_role = $('#idrole').val();
        	table.ajax.url(urls+'list-best/'+id_role+'/'+id_monper+'/'+year).load();
                btn_apply();
        });
        
        
        //Indikator SDG untuk mapping
	        
        $.ajax({
        url: urls + 'list-sdgGoals',
        type: 'get',
        dataType: 'json',
        cache: false,
        async : false,
        success: function (response) {
                        var option = "";
                        var cekbok = "";
                        for (var i = 0; i < response.content.length; i++) {
                                var nm_goals;
                                var id_goals=response.content[i].id;
                        if($("#fs").is(':checked')){
                                nm_goals = response.content[i].nm_goals;
                                        }else{
                                                nm_goals = response.content[i].nm_goals_eng;
                                        }
                        option += '<optgroup id="" label="'+response.content[i].id_goals+' '+nm_goals+'">';
                        cekbok += '<label for="menu'+id_goals +'" style="display:inline-block;white-space:nowrap;">'+
                                                '<input class="menu-master sdg-indikator" id="menu'+id_goals+'" name="sdg_indicator" data-id="'+id_goals+'" type="checkbox" style="vertical-align:middle" value="'+response.content[i].id+'---0---0">&nbsp;&nbsp;&nbsp;'+
                                            '<span style="vertical-align:middle">'+nm_goals+'</span>'+
                                      '</label><br/>';
                        $.ajax({
                        url: urls + 'list-sdgTarget/'+response.content[i].id,
                        type: 'get',
                        dataType: 'json',
                        cache: false,
                        async : false,
                        success: function (result) {
                                for (var j = 0; j < result.content.length; j++) {
                                        var nm_target;
                                        var id_target=result.content[j].id;
                                if($("#fs").is(':checked')){
                                        nm_target = result.content[j].nm_target;
                                                        }else{
                                                                nm_target = result.content[j].nm_target_eng;
                                                        }
                                option += '<optgroup id="" label="'+result.content[j].id_target+' '+nm_target+'">';
                                cekbok += '<label for="submenu'+id_target+'" style="display:inline-block;white-space:nowrap;margin-left:20px">'+
                                                                '<input data-goals="'+id_goals+'" data-id="'+id_target+'" class="sdg-indikator menu'+id_goals+' menu-slave" id="submenu'+id_target+'" type="checkbox" name="sdg_indicator" style="vertical-align:middle"  value="'+response.content[i].id+'---'+result.content[j].id+'---0">&nbsp;&nbsp;&nbsp;'+
                                                                            '<span style="vertical-align:middle">'+nm_target+'</span>'+
                                                                      '</label><br/>';
                                $.ajax({
                                    url: urls + 'list-sdgIndicator/'+response.content[i].id+'/'+result.content[j].id,
                                    type: 'get',
                                    dataType: 'json',
                                    cache: false,
                                    async : false,
                                    success: function (result1) {
                                        for (var k = 0; k < result1.content.length; k++) {
                                                var nm_indicator;
                                                var id_indicator=result1.content[k][0];
                                                if($("#fs").is(':checked')){
                                                        nm_indicator = result1.content[k][4];
                                                                }else{
                                                                        nm_indicator = result1.content[k][6];
                                                                }
                                                option += '<option value="'+response.content[i].id+'---'+result.content[j].id+'---'+result1.content[k][0]+'">'+result1.content[k][1]+' '+nm_indicator+'</option>';
                                                cekbok += '<label for="submenu1'+id_indicator+'" style="display:inline-block;white-space:nowrap;margin-left:40px">'+
                                                                                    '<input data-goals="'+id_goals+'" data-id="'+id_target+'" class="sdg-indikator menu'+id_goals+' menu-slave'+id_target+' menu-slave-1 menu-slave-1-'+id_target+'" id="submenu1'+id_indicator+'" type="checkbox" name="sdg_indicator" id="sdg_indicator" style="vertical-align:middle" value="'+response.content[i].id+'---'+result.content[j].id+'---'+result1.content[k][0]+'">&nbsp;&nbsp;&nbsp;'+
                                                                                    '<span style="vertical-align:middle">'+nm_indicator+'</span>'+
                                                                              '</label><br/>';
                                        }
                                    }
                                });
                                option += '</optgroup>';
                                }
                        }
                        });
                        option += '</optgroup>';
                        }
                        $('.accordion-inner').append(cekbok);
                }
        });
        $('.accordion-inner').on('click', '.menu-master', function(){
                var id = $(this).data('id');
                if ($(this).is(":checked")) {
                $(".accordion-inner").find('.menu'+id).prop("checked", false);
            } else {
                 $(".accordion-inner").find('.menu'+id).prop("checked", false);
            }
        });

        $('.accordion-inner').on('click', '.menu-slave', function(){
                var id = $(this).data('id');
                var goals = $(this).data('goals');
                if ($(this).is(":checked")) {
                $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
            } else {
                 $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
            }

                if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
            } else {
                 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
            }
        });

        $('.accordion-inner').on('click', '.menu-slave-1', function(){
                var id = $(this).data('id');
                var goals = $(this).data('goals');
                if ($(".menu-slave-1-"+id+":checked").length==$(".menu-slave-1-"+id).length) {
                $(".accordion-inner").find('#submenu'+id).prop("checked", false);
            } else {
                 $(".accordion-inner").find('#submenu'+id).prop("checked", false);
            }

                if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
            } else {
                 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
            }
//            console.log();
        });
        
        $('.accordion-inner').on('change', 'input[name="sdg_indicator"]', function(){
        	var sdg_indicator;
            var sdg_indicator_val = [];
		    $.each($("input[name='sdg_indicator']:checked"), function(){
		                sdg_indicator_val.push($(this).val());
		    });
            if(sdg_indicator_val.length>0){
                    sdg_indicator = sdg_indicator_val.toString();
            }else{
                    sdg_indicator = '0';
            }
            console.log(sdg_indicator);
        });
        
        $('#submit').on('click', function(){
			var id = $('#id').val();
			var id_prog = $('#id_program').val();
//			var id_prog = $('#id_program').val().split("###");
			var id_program = id_prog[0];
			var id_activity = id_prog[1];
			var id_indicator = id_prog[2];
			var id_role = $('#idrole').val();
			var location = $('#location').val();
			var time_activity = $('#time_activity').val()+" "+$('#jam').val()+":"+$('#menit').val()+":00";
			var background = $('#background').val();
			var implementation_process = $('#implementation_process').val();
			var challenges_learning = $('#challenges_learning').val();
			var periode = $('#periode').val().split("###");
			var id_monper = periode[0];
            var year = periode[1];
            
			var sdg_indicator;
            var sdg_indicator_val = [];
	        $.each($("input[name='sdg_indicator']:checked"), function(){
                 sdg_indicator_val.push($(this).val());
	        });
            if(sdg_indicator_val.length>0){
                    sdg_indicator = sdg_indicator_val.toString();
            }else{
                    sdg_indicator = '0';
            }
            console.log(sdg_indicator);
            
			$('.control-group').removeClass('error');
			$('.help-block').text("");
			var cek = 0;
                        
//                        if (id_gov_indicator == ""){
//                            $("#error_id_gov_indicator").parents(".control-group").first().addClass("error");
//                            $("#error_id_gov_indicator").text(required);
//                            cek += 1;
//                        }
			/* if (id_gov_indicator == ""){
                $("#error_id_gov_indicator").parents(".control-group").first().addClass("error");
                $("#error_id_gov_indicator").text(required);
                cek += 1;
            }
			if (unit == ""){
                $("#error_unit").parents(".control-group").first().addClass("error");
                $("#error_unit").text(required);
                cek += 1;
            } */
                if(cek==0){
                    var data = JSON.stringify({
                            'id':id,
                            'id_program':'',
                            'id_activity':'',
                            'id_indicator':'',
                            'id_role':id_role,
                            'location':location,
                            'program':id_prog,
                            'time_activity':time_activity,
                            'background':background,
                            'implementation_process':implementation_process,
                            'challenges_learning':challenges_learning,
                            'id_monper':id_monper,
                            'year':year
                            });
                $.ajax({
                    type: "POST",
                    url: urls+'save-best/'+sdg_indicator+'/'+id_monper+'/'+$('#id_prov').val(),
                    beforeSend : function(xhr){
                    	xhr.setRequestHeader(header,token);
                    },
                    headers:{'Accept':'application/json','Content-Type':'application/json'},
                    data: data,
                    success: function (result) {
                        
                        $.ajax({
                            type: "POST",
                            url: urls+'save-govIndicatorBest/'+sdg_indicator+'/'+$('#id_monper').val()+'/'+$('#id_prov').val(),
                            beforeSend : function(xhr){
                                xhr.setRequestHeader(header,token);
                            },
                            headers:{'Accept':'application/json','Content-Type':'application/json'},
                            data: data,
                            success: function (result12) {
                                
                            }
                        });
                    	table.ajax.url(urls+'list-best/'+id_role+'/'+id_monper+'/'+year).load();
                    	$('#myModal').modal('hide');
                    },
                });
			}
		});
        
        function clearForm(){
			$('#id').val("");
			$('#id_program').val("").removeAttr("readonly");
			$('#location').val("").removeAttr("readonly");
			$('#time_activity').val("").removeAttr("readonly");
			$('#background').val("").removeAttr("readonly");
			$('#implementation_process').val("").removeAttr("readonly");
			$('#challenges_learning').val("").removeAttr("readonly");
			$('#sdg_indicator').val("").trigger('change');
			$('#sdg_indicator').removeAttr("disabled");
			$(".accordion-inner").find('.sdg-indikator').prop("checked", false);
			$(".accordion-inner").find('.sdg-indikator').removeAttr("disabled");
			$('.control-group').removeClass('error');
			$('.help-block').text("");
		}
        
        $('#tbody-best').on('click', '.update', function(){
			var id = $(this).attr('data-id');
			program();
			$.ajax({
				type: "GET",
                url: urls+'get-best/'+id,
                success: function (result) {
                	var val = result.content;
                	$('#showModal').trigger('click');
                	$('#id').val(val.id);
                	$('#id_program').val(val.program);
                    $('#location').val(val.location);
                    $('#time_activity').val(val.time_activity);
                    $('#background').val(val.background);
                    $('#implementation_process').val(val.implementation_process);
                    $('#challenges_learning').val(val.challenges_learning);
                    $.ajax({
    					type: "GET",
                        url: urls+'list-getBestMapByGovInd/'+val.id,
                        success: function (hasil) {
                        		var val = hasil.content;
                        		var selectedValues = new Array();
                        		for(var i=0;i<val.length;i++){
                        			selectedValues[i] = val[i].id_goals+'---'+(val[i].id_target?val[i].id_target:0)+'---'+(val[i].id_indicator?val[i].id_indicator:0);
                        			$(".accordion-inner").find('.sdg-indikator[value="'+selectedValues[i]+'"]').prop("checked", true);
                        		}
                        	}
                    });
                },
            })
         });
        
        $('.tutup').on('click', function(){
			clearForm();
		});
     // ]]>
    </script>
</html>